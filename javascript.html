<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>JavaScript - Sagittarius Wiki</title>
	<script src="js/main.js"></script>
	<script>printFavicon();</script>

	<link href="css/bootstrap.css" rel="stylesheet" />
	<link href="css/bootstrap-responsive.css" rel="stylesheet" />
	<link href="css/docs.css" rel="stylesheet" />
	<link href="css/prettify.css" rel="stylesheet" />

	<!--[if lt IE 9]>
		<script src="js/html5shiv.js"></script>
	<![endif]-->
</head>
<body data-spy="scroll" data-target=".bs-docs-sidebar">
	<script>printNav("JavaScript");</script>

	<header class="jumbotron subhead" id="overview">
		<div class="container">
			<h1>JavaScript</h1>
			<p class="lead">The tutorial hub for the JavaScript starter kit</p>
		</div>
	</header>

	<div class="container">
		<div class="row">
			<div class="span3 bs-docs-sidebar">
				<ul class="nav nav-list bs-docs-sidenav">
					<li><a href="#basic-integration"><i class="icon-chevron-right"></i>Basic Integration</a></li>
					<li><a href="#easy-motd-module"><i class="icon-chevron-right"></i>Easy: MOTD Module</a></li>
					<li><a href="#medium-server-browser"><i class="icon-chevron-right"></i>Medium: Server Browser</a></li>
					<li><a href="#special-functions"><i class="icon-chevron-right"></i>Special Functions</a></li>
					<li><a href="#logging"><i class="icon-chevron-right"></i>Logging</a></li>
				</ul>
			</div>
			<div class="span9">

				<section id="basic-integration">
					<div class="page-header">
						<h1>Basic Integration</h1>
					</div>
					<p>Copy <code>sagittarius.js</code> into a convenient place in your project's tree, for example the <code>js/</code> directory if you have one.</p>
					<p>Once you have added the file to your project, creating an instance of Sagittarius is very simple:</p>
<pre class="prettyprint">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
	&lt;head&gt;
		&lt;script src="js/sagittarius.js"&gt;&lt;/script&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;script&gt;
			var sag = new Sagittarius("[APP ID HERE]", "[APP PASSWORD HERE]");
		&lt;/script&gt;
	&lt;/body&gt;
&lt;/html&gt;
</pre>
					<p>Make sure to replace <code>[APP ID HERE]</code> and <code>[APP PASSWORD HERE]</code>with your own application ID and password. At this point Sagittarius will be fully integrated and ready to use, but it can't really do anything just yet. To start leveraging its power you will need to write some <i>modules</i>.</p>
				</section>

				<section id="easy-motd-module">
					<div class="page-header">
						<h1>Easy: MOTD Module</h1>
					</div>
					
					<h2 id="understanding-modules">Understanding Modules</h2>
					<p>Sagittarius is structured around the idea of <span class="label label-important">MODULES</span> that perform <span class="label label-important">ACTIONS</span>. The actions that Sagittarius is capable of performing are fixed; that is, you will never have to write an &ldquo;action&rdquo; function to do something. You <i>will</i>, however, have to create modules that use the actions available to Sagittarius.</p>
					<p>Fortunately for us, JavaScript makes it very easy to write and add new modules (and therefore new functionality) to Sagittarius. Another great thing is that you can write as many modules as you'd like: a Server Module, a Login Module, and so on -- one for each of the features you'd like your game to support.</p>
					<p>To better understand how modules work, let's write a simple Message of the Day Module.</p>

					<h2 id="uploading-a-motd">Uploading a MOTD</h2>
					<p>Before we start coding, we need to define what we want our MOTD to be and actually host one on our App Engine application. Our MOTD will be extremely simple, just a single string that we will call the &ldquo;message&rdquo;. A full MOTD DBObject might look something like this:</p>
<pre class="prettyprint">
object_type="motd"
object_name="motd"
message="Welcome to my game, have fun playing!"
</pre>
					<p>The first two attributes are required, so we'll simply set them as <code>"motd"</code> to make filtering for the MOTD easier.</p>
					<p>Now we need to upload our message. You can use the <a href="wizard.html">Sagittarius Wizard</a> to do this. If this is your first time uploading a MOTD, set the action button to <strong>Add</strong> and add three <strong>Add Attribute</strong> buttons to set the attributes to the values listed above. If you already have a MOTD, you can set the action button to <strong>Modify</strong> instead to modify the message attribute.</p>

					<h2 id="defining-our-module">Defining Our Module</h2>
					<p>What makes JavaScript so great when it comes to writing modules is that it supports code modularity <i>and</i> asynchronous functions out of the box. To see these features in action, create a new file -- let's call it <code>motdmodule.js</code> -- and add the following code:</p>
<pre class="prettyprint linenums pre-scrollable">
var motd;

Sagittarius.prototype.GetMOTD = function () {
	return motd;
};

Sagittarius.prototype.QueryMOTD = function (callback) {
	var ga = this.CreateAction('get'), pass = this.pass;
	this.SubmitAction(
		ga.AddFilter(ga.DBTYPE, 'motd')
			.AddFilter(ga.DBNAME, 'motd')
			.AddProjection('message', true)
			.Unique(),
		function (data) {
			motd = Encryption.Decrypt(data.dbobjects[0].message, pass);
			callback();
		}
	);
};
</pre>
					<p>Whoa, that was a lot of code all at once! Let's break it down line-by-line.</p>

					<h3>Caching the MOTD</h3>
					<p>The first line, <code>var motd;</code>, defines a <strong>local cache</strong> for our MOTD. The reason for this is that every time you communicate with your App Engine application, you use a tiny bit of its <a href="https://developers.google.com/appengine/docs/quotas">quota</a>. If you go over the quota your application will go down (equivalent to a crash), so it's important to communicate only when absolutely necessary.</p>
					<p>In the case of the Message of the Day, we expect the message to change approximately once every 24 hours -- not very often, in other words. Although the MOTD may be updated while the player is playing, we will assume that this scenario is very unlikely. So, we can get away with only querying for the MOTD <i>once</i>: upon starting the game.</p>
					<p>The typical way to handle data from Sagittarius is to maintain such a cache. When you ask Sagittarius for new information, the local cache is updated. Although we might get the MOTD value often (every time the player exits to the main menu, for example), we are really only getting its cached value.</p>

					<h3>Adding New Functionality</h3>
					<p>As you might expect, the function <code>GetMOTD()</code> handles returning the value currently in the cache. In particular, this function shows how to add new functionality to Sagittarius through its <strong>prototype</strong>.</p>
					<p>Suppose you wanted to add a function called <code>MyFunction()</code> to Sagittarius that you could call as long as you had a Sagittarius instance. All you'd have to do is write something like this:</p>
<pre class="prettyprint linenums">
Sagittarius.prototype.MyFunction = function () {
	// Insert the awesomeness here!
};
</pre>
					<p>And to call it, all you'd need to do is:</p>
<pre class="prettyprint linenums">
mySagittariusInstance.MyFunction();
</pre>
					<p>Pretty easy, right? Admittedly, this probably isn't the best way to handle modules in JavaScript because of security reasons. If you know a more robust way I'd love to hear about it!</p>

					<h3>Querying the MOTD</h3>
					<p>Our <code>QueryMOTD()</code> function handles actually communicating with the server, and showcases the concept of using actions. The most important thing to understand is that while writing functions defined within the <code>Sagittarius.prototype</code> scope, any reference to a Sagittarius function must be preceded by <code>this.</code>. Also of note is the <code>callback</code> parameter, which is a function that users of this module can pass to <code>QueryMOTD()</code>. Once the querying is complete, this function will be called.</p>
					<p>Sagittarius has a special function called <code>CreateAction()</code> that makes it easy to construct an action &ldquo;object&rdquo;. Here, we want a GetAction, so we call <code>this.CreateAction('get')</code>. We could have also called the function with the strings &lsquo;add&rsquo;, &lsquo;mod&rsquo;, or &lsquo;del&rsquo; to make an Add, Modify, or Delete action, respectively.</p>
					<p>Once we have our action, we can add our filters and projections to it. We only want to get the DBObject with <code>object_type=="motd"</code> and <code>object_name=="motd"</code>, so we add those filters using the special shortcut variables <code>DBTYPE</code> and <code>DBNAME</code> respectively. We only want to return the actual <i>message</i>, so we add a projection for that field. Since we expect there to be only one MOTD, we make the query unique. Because all actions in Sagittarius support chaining, we were able to do this all in one line.</p>
					<p>The last step is to submit the action to Sagittarius, which we can do with the function <code>SubmitAction()</code>. The second parameter is function that will be called once a response from the server has been received. In our case, we want to set the new value of the <code>motd</code> variable and call our <i>own</i> callback function.</p>

					<h2 id="using-our-motd-module">Using Our MOTD Module</h2>
					<p>Since this is a simple tutorial, we'll just create a webpage that prints the MOTD to the screen as soon as it is received:</p>
<pre class="prettyprint linenums pre-scrollable">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
	&lt;head&gt;
		&lt;script src="js/sagittarius.js"&gt;&lt;/script&gt;
		&lt;script src="js/motdmodule.js"&gt;&lt;/script&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;script&gt;
			var sag = new Sagittarius("[APP ID HERE]", "[APP PASSWORD HERE]");
			sag.QueryMOTD(function () {
				document.write(sag.GetMOTD());
			});
		&lt;/script&gt;
	&lt;/body&gt;
&lt;/html&gt;
</pre>
					<p>Just remember that you must include <code>sagittarius.js</code> <i>before</i> any of its modules.</p>
					<p>Because of our callback parameter in <code>QueryMOTD()</code>, handling an asynchronous call to Sagittarius is very trivial. All we do is pass an anonymous function that writes the value of the local MOTD cache to the HTML document as soon as it is available. To test your module out, just open the page in your favorite browser. You should see the Message of the Day appear on the screen after a few seconds.</p>
					<p>Congratulations, you have just written your first module!</p>
				</section>

				<section id="medium-server-browser">
					<div class="page-header">
						<h1>Medium: Server Browser</h1>
					</div>
					<p class="lead">Coming soon!</p>
				</section>

				<section id="special-functions">
					<div class="page-header">
						<h1>Special Functions</h1>
					</div>

					<h2 id="sending-mail">Sending Mail</h2>
					<p>You can send an email any time from within your application using the <code>SendMail()</code> function:</p>
<pre class="prettyprint">
mySagittariusInstance.SendMail({
	receiver: 'john.doe@gmail.com',
	subject: 'Hello world!',
	message: 'This email was sent from Sagittarius.\n\nHave a nice day!',
	sender: 'sender',
	callback: function (data) {
		document.write("Mail successfully sent!");
	}
});
</pre>
					<p>The sender parameter is a string referencing the subdomain of your application that you want the email to be sent from. For example, if your <code>Application Identifier</code> is &ldquo;myapplication&rdquo; and your sender parameter is set to &ldquo;donuts&rdquo;, then the recipient will receive an email from <strong>donuts@myapplication.appspotmail.com</strong>. Note that if you pass in an empty string for the sender, it will default to &ldquo;admin&rdquo;.</p>
				</section>

				<section id="logging">
					<div class="page-header">
						<h1>Logging</h1>
					</div>
					<p class="lead">Coming soon!</p>
				</section>
			</div>
		</div>
	</div>

	<script>printFooter();</script>

	<script src="js/jquery.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/holder.js"></script>
	<script src="js/prettify.js"></script>
	<script src="js/application.js"></script>
</body>
</html>